# Вправа 6.1. Зовнішній сервіс і сценарій його використання. 
## CoinGecko API
(Опис, документація та принцип використання взяті з джерела [https://docs.coingecko.com/v3.0.1/reference/introduction](https://docs.coingecko.com/v3.0.1/reference/introduction))  
CoinGecko є найбільшим у світі незалежним агрегатором криптоданих, який інтегрований із понад 1000 криптобіржами та містить понад 17 000 монет. CoinGecko API пропонує найбільш вичерпні та надійні дані крипторинку через кінцеві точки RESTful JSON.

Ось деякі з поширених випадків використання для клієнтів, які використовують CoinGecko API:
* Криптобіржі (CEX, DEX), торгові програми
* Гаманці (гарячі, холодні)
* Агрегатор даних, Crypto Screener, Інформаційна панель аналітики
* Block Explorer, Portfolio Tracker
* Протоколи DeFi, ринкові майданчики NFT, цифровий банк
* Тестування торгової стратегії
* Бухгалтерський облік, податки, аудит, HR Розрахунок заробітної плати
* Дослідження та аналіз: медіа, інституція, наука, венчурний капітал, фінанси
* Боти, платежі, електронна комерція

### Створення нового ключа API:
* Після реєстрації та входу в обліковий запис CoinGecko перейдіть на інформаційну панель розробника.
* Натисніть кнопку + Додати новий ключ, щоб створити новий ключ API.

### Створення API запиту
* Коренева URL-адреса API публічного демонстраційного плану CoinGecko – https://api.coingecko.com/api/v3/.

Для виконання запитів та отримання іформації широкого класу є багато енд-поінтів. Основні з них приведені у наступному списку:  
* /ping - Перевка статусу сервера API
* /simple/price - Запитати ціни однієї чи кількох монет, використовуючи їхні унікальні ідентифікатори Coin API
* /simple/token_price/{id} - Запитати ціни однієї чи кількох монет, використовуючи їхні унікальні ідентифікатори Coin API
* /coins/list - Запитати всі підтримувані монети на CoinGecko з ідентифікатором монет, назвою та символом
* /coins/{id} - Запитувати всі метадані (зображення, веб-сайти, соціальні мережі, опис, адресу контракту тощо) зі сторінки монети CoinGecko на основі певного ідентифікатора монети
* /coins/{id}/history - Запит історичних даних (ціна, ринкова капіталізація, 24-годинний обсяг, ...) на певну дату для монети на основі конкретного ідентифікатора монети
* /coins/{id}/market_chart - Отримати історичні дані графіка монети, включаючи час в UNIX, ціну, ринкову капіталізацію та 24-годинний обсяг на основі конкретного ідентифікатора монети
* /coins/{id}/contract/{contract_address} - Запитувати всі метадані (зображення, веб-сайти, соціальні мережі, опис, адресу контракту тощо) зі сторінки монет CoinGecko на основі платформи активів і конкретної адреси контракту токена
* /coins/categories/list - Запитувати всі категорії монет на CoinGecko
* /coins/categories - Запит - усіх категорій монет із ринковими даними (ринкова капіталізація, обсяг, ...) на CoinGecko
* /exchange_rates - Запит обмінних курсів BTC з іншими валютами  

# Вправа 6.2. Виклик API та опис прикладу його застосування.
Для цієї та наступної вправ реалізовано сервер, який буде докладніше описаний у наступній вправі. Для даного пункту його роль - відправити HTML сторінку, стилі CSS та скрипти JS клієнту, після чого сам виклик зовнішнього API відбувається з клієнта, без участі сервера.  

API використовується для того, щоб отримати історичні дані за потрібну дату про задану криптовалюту (Bitcoin. Ethereum. тощо): курс на вказаній валюті (наприклад uah або usd). Для його використання, на отриманій сторінці від сервера, потрібно натиснути на кнопку 'Перейти до API', після чого можна ввести необхідні дані, і отримати відповідь.  

Для цього використано енд-поінт `/coins/{id}/history`, який дозволяє отримати курси заданої криптоваьюти, а також і її символічне зображення. Дані, що повертаються, представлені у форматі JSON, і виглядають наступним чином:  
```
{
  "id": "bitcoin",
  "symbol": "btc",
  "name": "Bitcoin",
  "localization": {
    "en": "Bitcoin",
    "de": "Bitcoin",
    "es": "Bitcoin",
    ...
    "lt": "Bitcoin",
    "sl": "Bitcoin"
  },
  "image": {
    "thumb": "https://coin-images.coingecko.com/coins/images/1/thumb/bitcoin.png?1696501400",
    "small": "https://coin-images.coingecko.com/coins/images/1/small/bitcoin.png?1696501400"
  },
  "market_data": {
    "current_price": {
      "aed": 344025.1870955076,
      "ars": 96465315.46440375,
      "aud": 150476.697554734,
      "bch": 213.50430064758393,
      ...
      "uah": 3935292.88240924,
      "usd": 93663.44751964067,
      ...
    },
    "market_cap": {
      "aed": 6812934096770.402,
      "ars": 1910288594220600.5,
      "aud": 2979450333763.9497,
      "bch": 4228436416.3518977,
      ...
    },
    "total_volume": {
      "aed": 88391731699.47035,
      "ars": 24785209347091.117,
      "aud": 38662564184.83636,
      "bch": 54856491.813447036,
      ...
    }
  },
  "community_data": {
    "facebook_likes": null,
    "twitter_followers": null,
    "reddit_average_posts_48h": 0,
    "reddit_average_comments_48h": 0,
    "reddit_subscribers": null,
    "reddit_accounts_active_48h": 0
  },
  "developer_data": {
    "forks": null,
    "stars": null,
    "subscribers": null,
    "total_issues": null,
    "closed_issues": null,
    "pull_requests_merged": null,
    "pull_request_contributors": null,
    "code_additions_deletions_4_weeks": {
      "additions": null,
      "deletions": null
    },
    "commit_count_4_weeks": null
  },
  "public_interest_stats": {
    "alexa_rank": null,
    "bing_matches": null
  }
}
```  
У коді, робота з наким енд-поінтом на стороні клієнта, та обробка отриманих результатів виглядає наступним чином:
```
function searchHistory(crypto, currency, date, callback){
    fetch(`https://api.coingecko.com/api/v3/coins/${crypto.toLowerCase()}/history?date=${date}`,{
        "method": "GET",
        headers: {    
            'Content-Type': 'application/json'
        }
    })
    .then(res=>{
        if(!res.ok) throw "The error happened when querying API";
    }).then(res=>res.json())
    .then(data=>{
        const img = data["image"]["thumb"];
        const course = data["market_data"]["current_price"][`${currency}`];
        callback(course, img);
    })
    .catch(alert);
}
```
Це функція, яка приймає необхідні дані, і виконує запит, як асинхронну операцію. У ній функція fetch() повертає проміс - об'єкт який зберігає стан цієі операції, та дозволяє обробити результат методом then() та помилку методом catch(). Якщо відповідь отримана успішно, тоді відбирається курс у вказаній валюті, і потім ці дані разом з посиланням на символічне зображення криптовалюти передаються у функцію зворотнього виклику callback().  

# Вправа 6.3. HTTP-сервер для отримання особистих даних через логін у Moodle.
Для цього був створений сервер за допомогою платформи Node.js та бібліотеки Express. Реалізація відбувалась на мові JavaScript, яка використовувалась також і для створення сторони клієнта. Передбачено кореневий маршрут `'/'`, при запиті на який повертається статика з усіма потрібними сторінками та стилями (розміщено у директорії 'public'). Також є маршрут `'/student/:login'`, який дозволяє знайти дані студента (розміщені у файлі studentData.js) за логіном із запиту. Відповідь повертається також у форматі JSON, а запит, та його результат оброблюються подібно до попередньої вправи.
